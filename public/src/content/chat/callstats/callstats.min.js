/***
Copyright (c) 2013-2016, Dialogue.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.14.1 2016-08-11 */

!function(a){"use strict";var b=function(a,b,c){function d(){}function e(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function f(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function g(){var a=f();return a+Wa.currentOffset}function h(){return window.performance.now?window.performance.now():null}function i(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){qa=a})}function j(){return qa?qa.level:void 0}function k(){return qa?qa.charging:void 0}function l(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(a){pa=a})}function m(){Da||window.addEventListener("beforeunload",function(a){var b;for(b in Ua)Ua.hasOwnProperty(b)&&Pb(fb.userLeft,null,b,Ua[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function n(a,b){setTimeout(function(){var b=g(),c=b-a.data.apiTS;a.data.timeShift=c,ja(a.type,a.action,a.data,a.callback)},b)}function o(a,b,c,d,e){var f=$b(c,d),g=null;f?(g=h(),Pb(fb.mediaPlaybackStartEvent,b,c,a,{ssrc:e,highResTs:g},f,null)):console.error("sendMediaStartEvent: Invalid pcHash")}function p(a,b,c,d,e){var f=$b(c,d),g=null;f?(g=h(),Pb(fb.mediaSuspendedEvent,b,c,a,{ssrc:e,highResTs:g},f,null)):console.error("sendMediaSuspendedEvent: Invalid pcHash")}function q(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Ua[b].ucID;f.oncanplay=function(){o(g,a,b,d,e)},f.onsuspend=function(){p(g,a,b,d,e)}}}function r(a){var b=Ra.codebase,c=!1;if(null===a)c=!1;else if(b===yb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==db&&a instanceof db&&(c=!0),("function"==typeof a||b===yb.edge)&&(c=!0);return c}function s(a,b){var d,e;return a&&(b===yb.chrome?(d=a.googLocalAddress,d.concat(":",a.googRemoteAddress)):b===yb.firefox&&(d=a.localAddr,d.concat(":",a.remoteAddr))),e=new c(d,"TEXT"),e.getHash("SHA-1","B64")}function t(){var a;return a=navigator.onLine===!0?"online":"offline"}function u(a,b){var c=zb.unknown,d=null;if(b===yb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=zb.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=zb.audio),d=a.data.googCodecName);else{if(b!==yb.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=zb.video))}return Za.hasOwnProperty(a.data.ssrc)&&(Za[a.data.ssrc].mediaType=c,Za[a.data.ssrc].codec=d),c}function v(a,b){var c;return b===yb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===yb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function w(a,b){var c="unavailable";if(b===yb.chrome){var d,e,f;d=v(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===yb.firefox;return c}function x(a,b){var c;return b===yb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===yb.firefox,c}function y(a){var b;return b=isNaN(a)||0>a?null:a}function z(a,b){var c;if(b===yb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=y(parseInt(a.data.googRtt,10))}else if(b===yb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=y(parseInt(a.data.mozRtt,10))}else if(b===yb.edge&&a&&a.data.roundTripTime)return c=y(parseInt(a.data.roundTripTime,10))}function A(a){var b=isNaN(a)?null:a;return b}function B(a,b){var c;if(b===yb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=A(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===yb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=A(parseInt(a.data.jitter,10))}function C(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function D(a,b,c){var d;return b===zb.audio?a<c.audio.gThreshold?d=ob.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=ob.fair:a>c.audio.rThreshold&&(d=ob.bad):b===zb.video&&(a<c.video.gThreshold?d=ob.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=ob.fair:a>c.video.rThreshold&&(d=ob.bad)),d}function E(a,b,c){var d;return b===zb.audio?a>c.audio.gThreshold?d=ob.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=ob.fair:a<c.audio.rThreshold&&(d=ob.bad):b===zb.video&&(a>c.video.gThreshold?d=ob.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=ob.fair:a<c.video.rThreshold&&(d=ob.bad)),d}function F(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===ob.excellent?b=pb.excellent:c===ob.fair?b=pb.fair:c===ob.bad&&(b=pb.bad)),b}function G(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function H(a,b,c,d){var e=[];return c===yb.firefox?e=null:c===yb.chrome&&(e=G(a,b,d)),e}function I(a){if(a=A(a),null!==a){var b=0>a?null:a;return b}}function J(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function K(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,y,B,G,H,K,L,M,N,O,P,Q,R,S,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null;for(o in b.streams[c].outbound)if(b.streams[c].outbound.hasOwnProperty(o)){Q=b.streams[c].outbound[o].data,void 0!==e.streams[c]&&void 0!==e.streams[c].outbound&&void 0!==e.streams[c].outbound[o]?(j=A(parseInt(e.streams[c].outbound[o].data.bytesSent,10)),k=a.lastStatsSent.apiTS,K=A(parseInt(e.streams[c].outbound[o].data.packetsSent,10)),M=A(parseInt(e.streams[c].outbound[o].data.packetsLost,10)),N=A(parseInt(e.streams[c].outbound[o].data.discardedPackets,10))):(j=0,k=g,M=0,K=0,N=0),m=g,B=m-k,p=u(b.streams[c].outbound[o],f),q=w(b.streams[c].outbound[o],f),r=v(b.streams[c].outbound[o],f),s=x(b.streams[c].outbound[o],f),void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].outbound&&(d.streams[c].outbound={}),d.streams[c].outbound[o]={},n=z(b.streams[c].outbound[o],f),l=A(parseInt(Q.bytesSent,10)),null!==l&&null!==j&&j>l&&(j=0,Cb(wa,xa,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:h,ucID:i})),void 0!==Q.droppedFrames&&(O=I(parseInt(Q.droppedFrames,10)),null!==O&&null!==N&&N>O&&(N=0),null!==O&&null!==N&&(P=O-N)),L=I(parseInt(Q.packetsLost,10)),null!==L&&null!==M&&(U=L-M),H=I(parseInt(Q.packetsSent,10)),null!==H&&null!==K&&(G=H-K),void 0!==U&&void 0!==G&&G+U>0&&(V=U/(G+U)),B>0&&(null!==l&&null!==j&&(T=8*(l-j)/B),void 0!==G&&(ca=G/(B/1e3))),a=J(a,c,"rttInfo",o,"outbound","rttArray",!0),a=J(a,c,"fractionalLossInfo",o,"outbound","fractionalLossArray",!0),a=J(a,c,"timeElapse",o,"outbound","totalTimeMs",!1),a=J(a,c,"frameWidthInfo",o,"outbound","frameWidthArray",!0),a=J(a,c,"frameRateInfo",o,"outbound","frameRateArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[c].outbound[o].rttArray.push(parseInt(n,10)),void 0!==V&&null!==V&&a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray.push(V),void 0!==r&&null!==r&&a.frameRateInfo.streams[c].outbound[o].frameRateArray.push(parseInt(r,10)),void 0!==s&&null!==s&&a.frameWidthInfo.streams[c].outbound[o].frameWidthArray.push(parseInt(s,10)),W=C(95,a.rttInfo.streams[c].outbound[o].rttArray),Z=C(95,a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray),ea=C(95,a.frameWidthInfo.streams[c].outbound[o].frameWidthArray),da=C(95,a.frameRateInfo.streams[c].outbound[o].frameRateArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].outbound[o].totalTimeMs=a.timeElapse.streams[c].outbound[o].totalTimeMs+B),a.timeElapse.streams[c].outbound[o].totalTimeMs>0&&null!==l&&(ba=8*l/a.timeElapse.streams[c].outbound[o].totalTimeMs),d.streams[c].outbound[o]={csioIntMs:B,csioIntFL:V,csioIntPR:ca,csioIntBRKbps:T,csioMediaType:p,csioSig2Latency:W,csioAvgBRKbps:ba,csioTimeElapseMs:a.timeElapse.streams[c].outbound[o].totalTimeMs,csioRes:q,csioPercentileFl:Z,csioIntFramesDropped:P,csioPercentileFrameRate:da,csioPercentileFrameWidth:ea};for(R in Q)Q.hasOwnProperty(R)&&(d.streams[c].outbound[o][R]=Q[R]);p===zb.audio?(S=W+40,X=D(S,p,xb),Y=E(T,p,tb),t=F(X,Y),d.streams[c].outbound[o].csioMark=t,d.streams[c].outbound[o].csioeM=S):p===zb.video&&(y=parseInt(a.rttInfo.streams[c].outbound[o].frameRate,10),$=E(r/y,p,ub),_=D(n,p,vb),aa=E(T,p,tb),t=F($,_,aa),a.rttInfo.streams[c].outbound[o].frameRate=r,d.streams[c].outbound[o].csioMark=t)}}function L(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,y,G,H,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=null,ga=null,ha=null,ia=null;for(q in b.streams[c].inbound)if(b.streams[c].inbound.hasOwnProperty(q)){U=b.streams[c].inbound[q].data,void 0!==e.streams[c]&&void 0!==e.streams[c].inbound&&void 0!==e.streams[c].inbound[q]?(j=A(parseInt(e.streams[c].inbound[q].data.bytesReceived,10)),n=A(parseInt(e.streams[c].inbound[q].data.packetsLost,10)),Q=A(parseInt(e.streams[c].inbound[q].data.packetsReceived,10)),k=a.lastStatsSent.apiTS,S=A(parseInt(e.streams[c].inbound[q].data.discardedPackets,10))):(j=0,k=g,n=0,Q=0,S=0),r=u(b.streams[c].inbound[q],f),s=w(b.streams[c].inbound[q],f),y=v(b.streams[c].inbound[q],f),t=B(b.streams[c].inbound[q],f),X=x(b.streams[c].inbound[q],f),p=z(b.streams[c].inbound[q],f),l=A(parseInt(U.bytesReceived,10)),null!==l&&null!==j&&j>l&&(j=0,n=0,Q=0,Cb(wa,xa,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:h,ucID:i})),o=I(parseInt(U.packetsLost,10)),m=g,void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].inbound&&(d.streams[c].inbound={}),d.streams[c].inbound[q]={},null!==o&&null!==n&&(Z=o-n),void 0!==U.discardedPackets&&(R=I(parseInt(U.discardedPackets,10)),null!==R&&null!==S&&S>R&&(S=0),null!==R&&null!==S&&(T=R-S)),P=I(parseInt(U.packetsReceived,10)),G=P-Q,void 0!==Z&&null!==G&&G+Z>0&&(_=Z/(G+Z)),O=m-k,O>0&&(null!==l&&null!==j&&(Y=8*(l-j)/O),null!==G&&($=G/(O/1e3))),a=J(a,c,"rttInfo",q,"inbound","rttArray",!0),a=J(a,c,"timeElapse",q,"inbound","totalTimeMs",!1),a=J(a,c,"jitterInfo",q,"inbound","jitterArray",!0),a=J(a,c,"fractionalLossInfo",q,"inbound","fractionalLossArray",!0),a=J(a,c,"frameWidthInfo",q,"inbound","frameWidthArray",!0),a=J(a,c,"frameRateInfo",q,"inbound","frameRateArray",!0),void 0!==p&&null!==p&&a.rttInfo.streams[c].inbound[q].rttArray.push(parseInt(p,10)),void 0!==t&&null!==t&&a.jitterInfo.streams[c].inbound[q].jitterArray.push(parseInt(t,10)),void 0!==_&&null!==_&&a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray.push(_),void 0!==y&&null!==y&&a.frameRateInfo.streams[c].inbound[q].frameRateArray.push(parseInt(y,10)),void 0!==X&&null!==X&&a.frameWidthInfo.streams[c].inbound[q].frameWidthArray.push(parseInt(X,10)),aa=C(95,a.rttInfo.streams[c].inbound[q].rttArray),ba=C(95,a.jitterInfo.streams[c].inbound[q].jitterArray),ca=C(95,a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray),ha=C(95,a.frameRateInfo.streams[c].inbound[q].frameRateArray),ia=C(95,a.frameWidthInfo.streams[c].inbound[q].frameWidthArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].inbound[q].totalTimeMs=a.timeElapse.streams[c].inbound[q].totalTimeMs+O),null!==l&&a.timeElapse.streams[c].inbound[q].totalTimeMs>0&&(ga=8*l/a.timeElapse.streams[c].inbound[q].totalTimeMs),d.streams[c].inbound[q]={csioIntMs:O,csioIntFL:_,csioIntPR:$,csioIntBRKbps:Y,csioSig2Latency:aa,csioAvgBRKbps:ga,csioMediaType:r,csioTimeElapseMs:a.timeElapse.streams[c].inbound[q].totalTimeMs,csioIntPktRcv:G,csioIntPktLoss:Z,csioPercentileJitter:ba,csioRes:s,csioPercentileFl:ca,csioIntPktDiscarded:T,csioPercentileFrameRate:ha,csioPercentileFrameWidth:ia};for(V in U)U.hasOwnProperty(V)&&(d.streams[c].inbound[q][V]=U[V]);r===zb.audio?(W=aa+40,da=D(W,r,xb),ea=D(_,r,wb),fa=E(Y,r,tb),H=F(da,ea,fa),d.streams[c].inbound[q].csioMark=H,d.streams[c].inbound[q].csioeM=W):r===zb.video&&(K=a.rttInfo.streams[c].inbound[q].frameRate,L=E(y/K,r,ub),M=D(p,r,vb),N=E(Y,r,tb),H=F(L,M,N),a.rttInfo.streams[c].inbound[q].frameRate=y,d.streams[c].inbound[q].csioMark=H)}}function M(a,b,c,d,e,f){var g={streams:{}};g.fabricState=a.pcState,g.connectionState=t();var h=null;h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:{}};var i;for(i in b.streams)b.streams.hasOwnProperty(i)&&(void 0!==b.streams[i].inbound&&L(a,b,i,g,h,c,d,e,f),void 0!==b.streams[i].outbound&&K(a,b,i,g,h,c,d,e,f),void 0===g.streams[i]&&(g.streams[i]={}),b.streams[i].cname&&(g.streams[i].cname=b.streams[i].cname),b.streams[i].usage&&(g.streams[i].usage=b.streams[i].usage),b.streams[i].msid&&(g.streams[i].msid=b.streams[i].msid),b.streams[i].userID&&(g.streams[i].userID=b.streams[i].userID),b.streams[i].associatedVideoTag&&(g.streams[i].associatedVideoTag=b.streams[i].associatedVideoTag));if(c===yb.firefox)for(i in g.streams)g.streams.hasOwnProperty(i)&&void 0!==g.streams[i].inbound&&void 0!==g.streams[i].inbound[nb.remote]&&(void 0===g.streams[i].outbound&&(g.streams[i].outbound={}),void 0===g.streams[i].outbound[nb.local]&&(g.streams[i].outbound[nb.local]={}),g.streams[i].outbound[nb.local].rtt=g.streams[i].inbound[nb.remote].rtt);return g}function N(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===pb.bad?a.streams[b].inbound[d].mark=2:c===pb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===pb.bad?a.streams[b].outbound[d].mark=2:c===pb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function O(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function P(a){var b={};a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ca&&(b.conferenceURL=Ca);var c,d,e,f;b.streams={};for(c in a.streams)if(a.streams.hasOwnProperty(c)){if(void 0===b.streams[c]&&(b.streams[c]={}),a.streams[c].cname&&(b.streams[c].cname=a.streams[c].cname),a.streams[c].msid&&(b.streams[c].msid=a.streams[c].msid),a.streams[c].userID&&(b.streams[c].remoteUserID=a.streams[c].userID),a.streams[c].usage&&(b.streams[c].usageLabel=a.streams[c].usage),a.streams[c].associatedVideoTag&&(b.streams[c].associatedVideoTag=a.streams[c].associatedVideoTag),void 0!==a.streams[c].inbound)for(d in a.streams[c].inbound)a.streams[c].inbound.hasOwnProperty(d)&&(e=a.streams[c].inbound[d],d===nb.local&&(b.streams[c].reportType=nb.inbound,e.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=e.csioIntFL),e.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=e.csioIntBRKbps),e.hasOwnProperty("csioMark")&&(b.streams[c].quality=e.csioMark),e.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=e.csioMediaType),e.hasOwnProperty("googRtt")&&(b.streams[c].rtt=e.googRtt),e.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=e.mozRtt),e.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=e.roundTripTime),e.hasOwnProperty("jitter")&&(b.streams[c].jitter=e.jitter),e.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=e.googJitterReceived),e.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=e.audioOutputLevel),e.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=e.audioInputLevel)));if(void 0!==a.streams[c].outbound)for(d in a.streams[c].outbound)a.streams[c].outbound.hasOwnProperty(d)&&d===nb.local&&(f=a.streams[c].outbound[d],b.streams[c].reportType=nb.outbound,f.hasOwnProperty("csioIntFL")&&(b.streams[c].fractionLoss=f.csioIntFL),f.hasOwnProperty("csioIntBRKbps")&&(b.streams[c].bitrate=f.csioIntBRKbps),f.hasOwnProperty("csioMark")&&(b.streams[c].quality=f.csioMark),f.hasOwnProperty("csioMediaType")&&(b.streams[c].mediaType=f.csioMediaType),f.hasOwnProperty("googRtt")&&(b.streams[c].rtt=f.googRtt),f.hasOwnProperty("mozRtt")&&(b.streams[c].rtt=f.mozRtt),f.hasOwnProperty("roundTripTime")&&(b.streams[c].rtt=f.roundTripTime),f.hasOwnProperty("jitter")&&(b.streams[c].jitter=f.jitter),f.hasOwnProperty("googJitterReceived")&&(b.streams[c].jitter=f.googJitterReceived),f.hasOwnProperty("audioInputLevel")&&(b.streams[c].audioInputLevel=f.audioInputLevel),f.hasOwnProperty("audioOutputLevel")&&(b.streams[c].audioOutputLevel=f.audioOutputLevel))}return b}function Q(a,b,c,e,f,h){var i=g();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&ia()&&!Xa?(d("Pushing to the cloud ",a),ja(gb.processedStats,eb.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState):(a.clockUnsynced=Xa,Kb({type:gb.processedStats,action:eb.fabricStats,data:a}),a.hasOwnProperty("token")||Qa.sendAuthenticationRequest(wa,f))}function R(a,b,c,d,e,h,i){function l(l){var m=g(),n=f();void 0===e.lastRawStatsSentInterval||null===e.lastRawStatsSentInterval?e.lastRawStatsSentInterval=n-e.statsPollingStart:e.lastRawStatsSentInterval=n-e.rawstatsTS+e.lastRawStatsSentInterval,void 0===e.lastProcessedStatsSentInterval||null===e.lastProcessedStatsSentInterval?e.lastProcessedStatsSentInterval=n-e.statsPollingStart:e.lastProcessedStatsSentInterval=n-e.rawstatsTS+e.lastProcessedStatsSentInterval,e.rawstatsTS=n;var o={},p=Ra.codebase;o.version=va,o.appID=wa,o.conferenceID=encodeURIComponent(c),o.apiTS=m,o.timeShift=0,o.fabricState=e.pcState,o.pcID=e.pcHash,void 0!==d&&(o.ucID=d),Qa.authToken?o.token=Qa.authToken:Qa.sendAuthenticationRequest(wa,a),o.localID=encodeURIComponent(a),o.remoteID=encodeURIComponent(b),o.deviceID=Ba;var q,r,t,u,v,w,x,y,z={streams:{}},A=null,B=!1,C=!1,D={},E={};if(p===yb.firefox&&"Safari"!==Ra.name)A=[],l.forEach(function(a){A.push(a)});else if(p===yb.chrome&&"Safari"!==Ra.name)A=l.result();else{A=[];for(q in l)l.hasOwnProperty(q)&&A.push(l[q])}for(q=0;q<A.length;++q)r=W(A[q]),t=T(JSON.parse(r),p),X(t)||(t.hasOwnProperty("Transport")?(u="Transport",z.hasOwnProperty(u)||(z[u]=[]),p!==yb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(z[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=z[u].length)):(z[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=z[u].length))):t.hasOwnProperty("localCandidate")?D[t.localCandidate.id]=t.localCandidate:t.hasOwnProperty("remoteCandidate")?E[t.remoteCandidate.id]=t.remoteCandidate:t.hasOwnProperty("bwe")?z.bwe=t.bwe:(w=Mb(t.ssrc),void 0!==w&&w.localStartTime||(y=Ob(b,c,d,e,h,null),y&&(C=!0),w=Mb(t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=b),void 0===z.streams[t.ssrc]&&(z.streams[t.ssrc]={userID:v},void 0!==w&&(z.streams[t.ssrc].cname=w.cname,z.streams[t.ssrc].msid=w.msid)),t.inbound?(void 0===z.streams[t.ssrc].inbound&&(z.streams[t.ssrc].inbound={}),x=z.streams[t.ssrc].inbound,x[t.reportType]={data:t.data},w&&(z.streams[t.ssrc].usage=w.usage,z.streams[t.ssrc].associatedVideoTag=w.associatedVideoTag)):(void 0===z.streams[t.ssrc].outbound&&(z.streams[t.ssrc].outbound={}),z.streams[t.ssrc].outbound[t.reportType]={data:t.data})));p===yb.firefox&&(z.Transport=O(z.Transport,D,E));var F;if(z.Transport)for(F=0;F<z.Transport.length;F++)z.Transport[F].hash=s(z.Transport[F],p);o.statistics=z,z.Transport&&(B=V(z.Transport,e)),B&&bc(h,fb.updatedConfiguration,c),e.pcState===qb.disrupted&&$(o);var G=M(e,z,p,m,c,d);if(z.Transport&&(G.Transport=H(e,z.Transport,p,m)),z.bwe&&(G.bwe=z.bwe),void 0===e.processedStatsTupleArray&&(e.processedStatsTupleArray=[]),ra){var I=P(G);ra(I)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=j(),G.batteryStatus.isBatteryCharging=k(),G=N(G),e.processedStatsTupleArray.push(G),o.processedStatistics=e.processedStatsTupleArray,e.lastStatsSent=o;var J=la(o),K=la(o);delete J.processedStatistics,delete K.statistics,C&&Pb(fb.ssrcMap,b,c,d,Nb(),e.pcHash),(e.lastProcessedStatsSentInterval>=Ga||e.initialPhaseOver)&&(e.processedStatsTupleArray=[],Q(K,e,c,b,a,i),e.lastProcessedStatsSentInterval=0)}return l}function S(a){var b;return rb.hasOwnProperty(a)?a===rb.createOffer||a===rb.createAnswer||a===rb.setRemoteDescription?b=sb.negotiationFailure:a===rb.setLocalDescription?b=sb.sdpError:a===rb.addIceCandidate?b=sb.sdpError:a===rb.getUserMedia?b=sb.mediaConfigError:a===rb.iceConnectionFailure?b=sb.iceFailure:a===rb.signalingError?b=sb.signalingError:(a===rb.applicationLog||rb.applicationError)&&(b=sb.applicationLog):b=Db.invalidWebRTCFunctionName,b}function T(a,b){var c={};return b===yb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inboundrtp"===a.type?!0:!1,c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===yb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.inbound=!1:c.inbound=!0,c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"VideoBwe"===a.type&&(c.bwe=a):b===yb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inbound-rtp"===a.type?!0:!1,c.data=a,c.reportType="local"):"transport"===a.type&&(c.Transport=a)),c}function U(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function V(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=U(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function W(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function X(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function Y(a){return{magicKey:a,statsSubmissionInterval:La,endpoint:Ta,localUserIDObject:ya}}function Z(a,b,c){var d=Ua[a];void 0===d&&(Ua[a]={},Ua[a].participants=null,c&&(Ua[a].userJoinedSent=!0),b&&(Ua[a].refreshPresence=b))}function $(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function _(a){return clearInterval(a),null}function aa(){var a;for(a in Ua)Ua.hasOwnProperty(a)&&(Ua[a].refreshPresence=_(Ua[a].refreshPresence),delete Ua[a].refreshPresence);na()}function ba(){var a,b=function(a){return setInterval(function(){Rb(a)},Na)};for(a in Ua)Ua.hasOwnProperty(a)&&(Rb(a),Ua[a].refreshPresence=b(a));oa()}function ca(a){var b=Ua[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function da(a,b){var c=Ua[a],d=[];if(void 0===c)d.push(b),Ua[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function ea(a){var b=!1;if(!Ua[a])return{conferenceFinished:b,ucID:null};var c=Ua[a].ucID;return 0===Ua[a].participants.length&&(_(Ua[a].refreshPresence),na(),delete Ua[a],b=!0),{conferenceFinished:b,ucID:c}}function fa(a,b){Pb(fb.userLeft,null,a,b,null,null,null),_a=_(_a),na(),$a=Hb,Hb=null}function ga(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ca[a]=za+wa+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"}function ha(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ia(){return Ia}function ja(a,b,c,d){a===gb.clockSync?ia()?(Wa.syncStartTime=f(),c.syncStartTime=Wa.syncStartTime,c.offsetResultsLength=Wa.offsetResults.length,Ha.emit(a,JSON.stringify(c)),d&&b!==eb.fabricStats&&d(ib.success,b+" sent to the backend.")):setTimeout(function(){rc()},100):Qa._isTokenValid(Qa.authToken,wa,xa)?Xa&&c.action!==fb.userJoined&&c.action!==fb.refreshPresence&&c.action!==fb.fabricSetupFailed||!ia()?(c.clockUnsynced=Xa,Kb({type:b,action:a,data:c,callback:d})):(Ha.emit(a,JSON.stringify(c)),d&&b!==eb.fabricStats&&d(ib.success,b+" sent to the backend.")):Qa.sendAuthenticationRequest(wa,xa,function(e,f){e!==ib.success?(e===jb.authOngoing&&(c.clockUnsynced=Xa,Kb({type:b,action:a,data:c,callback:d})),d&&e!==jb.authOngoing&&d(e,f)):e===ib.success&&"SDK authentication successful."===f&&(Xa&&b!==fb.userJoined&&c.action!==fb.refreshPresence&&c.action!==fb.fabricSetupFailed||!ia()?(c.clockUnsynced=Xa,Kb({type:b,action:a,data:c,callback:d})):(c.token=Qa.authToken,Ha.emit(a,JSON.stringify(c)),d&&b!==eb.fabricStats&&d(ib.success,b+" sent to the backend.")))})}function ka(a){a&&a(jb.authOngoing,null)}function la(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=la(a[b]));return c}function ma(){var a={};Object.keys(Ua).forEach(function(b){var c=Ua[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:Qa.tokenData?!0:!1,clockSync:!Xa,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:va};Cb(wa,xa,"stateMachine",b)}function na(){ab||(ab=setInterval(function(){ma()},bb))}function oa(){_(ab),ab=null}var pa,qa,ra,sa="https://collector.callstats.io:443/",ta="https://auth.callstats.io/",ua="443",va="3.14.1",wa=null,xa=null,ya=null,za="https://dashboard.callstats.io/apps/",Aa="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",Ba=null,Ca={},Da=!1,Ea=!1,Fa=3e4,Ga=1e4,Ha=null,Ia=!1,Ja=!1,Ka="collectCallStats",La=15e3,Ma=!1,Na=1e4,Oa=5e3,Pa=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,d=300;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var e=null,f=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};window.crypto&&window.crypto.subtle?m.subtlecrypto=window.crypto.subtle:window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?m.subtlecrypto=window.crypto.webkitSubtle:(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);m.subtlecrypto.sign({name:"HMAC"},c,g).then(function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;f>g;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)})["catch"](function(a){return d(a)})},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(b){return null}},this._isTokenValid=function(a,b,c){var d=!1;if(null===a)return!1;try{var e=m.decode(a);if(null!==e&&e.appID===b&&e.userID===encodeURIComponent(c)){var f=null;if(navigator.mozGetUserMedia){var h=e.expiry.split(" ").join("T");f=Date.parse(h)}else f=new Date(e.expiry);var i=new Date(g());f>i&&(d=!0)}return d}catch(j){}return!1},this.setupAuthToken=function(a){window.localStorage.setItem("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),La=parseInt(this.tokenData.submissionInterval,10),Ma=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,f,g){if(d&&f){if(a.authInProgress)return void ka(g);null!==e&&(clearTimeout(e),e=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(ib.tokenGenerationError,i.toString()));var k=ta+"authenticate",l={client_id:f+"@"+wa,code:j,grant_type:"authorization_code"};pc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(k){}if(!j)return void(e=setTimeout(a.sendAuthenticationRequest,Oa,d,f,g));if(200===i.status){if("bearer"!==j.token_type)return void(e=setTimeout(a.sendAuthenticationRequest,Oa,d,f,g));a.setupAuthToken(j.access_token);var l=parseInt(1e3*parseInt(j.expires_in)*c);o(l,d,f,g),h=!1,g&&g(ib.success,"SDK authentication successful."),ia()?(Jb(),g&&g(ib.success,"WebSocket establishment successful.")):tc(sa+Ka,function(a,b){void 0!==g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(d,f,g,j[b]);e=setTimeout(a.sendAuthenticationRequest,Oa,d,f,g)}})})}};var n=function(){null!==f&&(clearTimeout(f),f=null)},o=function(b,c,d,e){n(),f=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===Eb.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===Eb.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===Eb.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,e=null,f=!1,h=null;return b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]),m.subtlecrypto.importKey("jwk",{kty:"oct",k:k(b),alg:"HS256",ext:!0},{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]).then(function(a){b=null,c=a})["catch"](function(a){f=!0,b=null}),function(b,i){if(f)return i("appsecret based token generation failed");if(!b&&null!==e)return i(null,e);
if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:xa,appID:wa,exp:parseInt(g()/1e3)+d,nbf:parseInt(g()/1e3)-d};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(e=b,i(null,b))})}}},Qa=new Pa,Ra=detectBrowserInfo(),Sa=measureAppLoadingPerformance(Ra),Ta={type:"browser",name:Ra.name,ver:Ra.ver,os:Ra.os},Ua={},Va={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},Wa={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Xa=!0,Ya=[],Za={},$a=null,_a=null,ab=null,bb=2e4,cb=100,db=null;"Firefox"===Ra.name?db=mozRTCPeerConnection:"Chrome"===Ra.name||"Opera"===Ra.name?db=webkitRTCPeerConnection:"Safari"===Ra.name?d("Browser type Safari"):"Edge"===Ra.name&&(db=window.RTCPeerConnection);var eb={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},fb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},gb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},hb={success:"success",failure:"failure"},ib={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},jb={authOngoing:"authOngoing"},kb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},lb={local:"local",remote:"remote"},mb={excellent:5,good:4,fair:3,poor:2,bad:1},nb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},ob={excellent:3,fair:2,bad:1},pb={excellent:"excellent",fair:"fair",bad:"bad"},qb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},rb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},sb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},tb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},ub={video:{gThreshold:.8,rThreshold:.3}},vb={video:{gThreshold:400,rThreshold:1e3}},wb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},xb={audio:{gThreshold:240,rThreshold:400}},yb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},zb={unknown:"unknown",audio:"audio",video:"video"},Ab=function(a,b){var c=null,d=null,e=null,g=new XMLHttpRequest;g&&(g.open("GET",encodeURI(a)),c=f(),g.onload=function(){d=f(),e=d-c,b(g,e)},g.send())},Bb=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Cb=function(a,b,c,d){var e=sa+"generics",f={appID:a,userID:encodeURIComponent(b),version:va,eventType:c,data:d};Bb(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:va,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Ua)Ua.hasOwnProperty(b)&&(d.conferenceID=b,Cb(wa,xa,"onErrorLog",d),c=!0);c||Cb(wa,xa,"onErrorLog",d)}});var Db={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Eb={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Fb="fabricSetupFailed error reported by the developer",Gb="Connectivity Failure",Hb=e(),Ib=function(a,b){if(!Qa.authToken)return void Qa.sendAuthenticationRequest(wa,xa);if(!Xa){var c,d,e,f,h=g(),i=[],j=Math.max(La/Ya.length,cb);for(c=0;c<Ya.length;c++)if(e=Ya[c],e.data.action!==fb.userJoined){if(e.data.token=Qa.authToken,a&&e.data.apiTS>=h-b||!e.data.ucID){if(f=decodeURIComponent(e.data.conferenceID),!Ua[f])continue;e.data.ucID=Ua[f].ucID}if(e.data.clockUnsynced&&(e.data.apiTS+=Wa.currentOffset),e.action===eb.fabricStats&&e.data.clockUnsynced&&e.data.processedStatistics&&e.data.processedStatistics.length>0)for(d=0;d<e.data.processedStatistics.length;d++)e.data.processedStatistics[d].apiTS+=Wa.currentOffset;delete e.data.clockUnsynced,n(e,j*(c+1))}else i.push(Ya[c]);Ya=i}},Jb=function(){if(!Qa.authToken)return void Qa.sendAuthenticationRequest(wa,xa);var a,b,c=[],d=Math.max(La/Ya.length,cb);for(a=0;a<Ya.length;a++)b=Ya[a],b.type!==gb.callStatsEvent||b.data.action!==fb.userJoined&&b.data.action!==eb.fabricSetupFailed?c.push(Ya[a]):(b.data.token=Qa.authToken,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+Wa.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=La),n(b,d*(a+1)));Ya=c},Kb=function(a){Ya.push(a)},Lb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),d=/^ssrc:(\d*) ([\w_]*):(.*)/,e=/^ssrc-group:SIM (\d*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],h=a.slice(2);if("a"===c){if(d.test(h)){var i=h.match(d),j=i[1];void 0===Za[j]&&(Za[j]={}),Za[j][i[2]]=i[3],Za[j].localStartTime=f(),Za[j].syncedStartTime=g(),Za[j].streamType=b}e.test(h)&&(void 0===Za.ssrcGroup&&(Za.ssrcGroup={},Za.ssrcGroup[b]={}),Za.ssrcGroup[b].simulcastGroup=h.match(/\d+/g))}})},Mb=function(a){return Za[a]},Nb=function(){return Za},Ob=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Lb(g,nb.outbound),Lb(h,nb.inbound),Ma){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Qb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Pb=function(a,b,c,d,e,f,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=g(),j={version:va,apiTS:i,action:a,localID:encodeURIComponent(xa),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:wa,ucID:d,pcID:f,deviceID:Ba,value:e};return null===b&&(j.remoteID=null),null===c?void Cb(wa,xa,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Qa.authToken&&ia()&&(d&&!Xa||a===fb.userJoined||a===eb.fabricSetupFailed||a===fb.refreshPresence)?(j.token=Qa.authToken,ja(gb.callStatsEvent,a,j,h)):(j.clockUnsynced=Xa,Qa.authToken||Qa.sendAuthenticationRequest(wa,xa),a!==fb.fabricStatsCaching&&a!==fb.refreshPresence&&Kb({type:gb.callStatsEvent,action:gb.callStatsEvent,data:j,callback:h})))},Qb=function(a,b,c,d,e,f){var h=g(),i={version:va,appID:wa,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(xa),remoteID:encodeURIComponent(a),pcID:e,deviceID:Ba,sdpPayload:d};Qa.authToken&&ia()&&c&&!Xa?(i.token=Qa.authToken,ja(gb.sdpSubmission,gb.sdpSubmission,i,f)):(i.clockUnsynced=Xa,Kb({type:gb.sdpSubmission,action:gb.sdpSubmission,data:i,callback:f}),Qa.authToken||Qa.sendAuthenticationRequest(wa,xa))},Rb=function(a){var b={ucID:Ua[a].ucID,magicKey:Hb,endpoint:Ta,fabricState:{},connectedDevices:pa},c=Ua[a];if(c&&c.participants){var d,e=c.participants,f=0;for(f=0;f<e.length;f++)d=e[f],b.fabricState[f]={pc:d.pcHash,userId:d.remoteUserID,pcState:d.pcState,iceConnectionState:d.pc.iceConnectionState,iceGatheringState:d.pc.iceGatheringState,iceCandidatesNumber:d.iceCandidates.length,numNegotiationNeededCalls:d.numNegotiationNeededCalls}}Xa||(b.clockSyncOffset=Wa.currentOffset),Pb(fb.refreshPresence,null,a,Ua[a].ucID,b,null)},Sb=function(a){var b={appID:wa,userID:encodeURIComponent(xa),version:va,endpoint:Ta,pagePerf:Sa,endpointID:Ba,wsID:a.io.engine.id};wa&&Qa.authToken&&(b.token=Qa.authToken,a.emit(gb.registerPresence,JSON.stringify(b)))},Tb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("csio_auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token?!0:!1;d||xa!==c.userID||(c.token=b.challenge.token,d=!0),d?ja(gb.userFeedback,gb.userFeedback,c):window.localStorage.removeItem("feedback")}},Ub=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Vb=function(a,b,d,e,g,h){if("function"!=typeof b){if(!window.crypto.subtle)return e(ib.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Ub(hb.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Qa.appSecretTokenGenerator(b)}if(!a||!d)return console.error("initialize: Argument missing/invalid"),Ub(hb.failure,"initialize: Argument missing/invalid");if(Qa.tokenGenerator=b,window.localStorage.getItem("csio_auth_data"))try{var i=JSON.parse(window.localStorage.getItem("csio_auth_data"));Qa._isTokenValid(i,a,d)&&(e&&e(ib.success,"SDK authentication successful."),Qa.setupAuthToken(i),ia()||tc(sa+Ka,e))}catch(j){}if("string"==typeof a&&(a=parseInt(a,10)),wa=a,"object"==typeof d?(xa=d.aliasName,ya=d):xa=d,h&&(h.disableBeforeUnloadHandler===!0&&(Da=!0),(null!==h.applicationVersion||void 0!==h.applicationVersion)&&(Ta.appVer=h.applicationVersion)),m(),Ba=window.localStorage.getItem("endpointID"),null===Ba){var k=f(),n=Math.random()*k,o=new c(n.toString(),"TEXT");Ba=o.getHash("SHA-1","B64"),window.localStorage.setItem("endpointID",Ba)}return l(),ra=g,Qa.sendAuthenticationRequest(a,d,e),Ub(hb.success)},Wb=function(a){return function(b){return b.remoteUserID===a?!0:void 0}},Xb=function(a,b){var c=!1,d=null;return Ua[a]&&Ua[a].participants&&(d=Ua[a].participants.filter(Wb(b))),c=d&&d.length>0?!0:!1},Yb=function(a){return function(b){return b.pc===a?!0:void 0}},Zb=function(a,b){var c=null,d=null;return Ua[a]&&Ua[a].participants&&(d=Ua[a].participants.filter(Yb(b))),c=d&&d.length>0?d[0]:null},$b=function(a,b){var c=null,d=null;return c=Zb(a,b),c&&(d=c.pcHash),d},_b=function(a){var b=null,c=null,d=null;for(b in Ua)if(Ua.hasOwnProperty(b)&&(d=Zb(b,a))){c={fabric:d,conferenceID:b};break}return c},ac=function(a,b){var c=0;if(a&&Ua[b].participants)for(c=0;c<Ua[b].participants.length;c++)if(Ua[b].participants[c].pcHash===a.pcHash){Ua[b].participants.splice(c,1);break}},bc=function(a,b,c,d){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Ub(hb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!wa||!xa||!Ua[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Ub(hb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===eb.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Ub(hb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!r(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Ub(hb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!eb.hasOwnProperty(b)&&!fb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Ub(hb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var e=null,g=null,h=f(),i=Ua[c],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Ub(hb.failure,"sendFabricEvent: Conference ID not found!");if(j=Zb(c,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Ub(hb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(!(b===eb.fabricSetup||b===fb.autoFabricSetup&&j.fabricSetupSent)){if(b===fb.autoFabricSetup){var l=h-j.startTime;e={setupDelay:l,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.pcState=qb.established,j.fabricSetupSent=!0}else if(b===fb.autoFabricSetupFailed)e={failureDelay:j.setupFailureTime,reason:sb.iceFailure,domError:Gb};else if(b===fb.fabricDisrupted)e={disruptionDelay:j.connectivityIceStatusDelay};else if(b===fb.updatedConfiguration)e=j.transportData;else if(b===eb.fabricSetupFailed){var m=h-k;e={failureDelay:m,reason:sb.iceFailure,domError:Fb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":rb.iceConnectionFailure,magicKey:Hb,endpoint:Ta}}else if(b===eb.activeDeviceList){if(!d||!d.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Ub(hb.failure,"sendFabricEvent: Arguments missing/Invalid");e={magicKey:Hb,endpoint:Ta,activeDevicelist:d.deviceList}}if(Pb(b,g,c,i.ucID,e,j.pcHash,j.pcCallback),(b===eb.fabricTerminated||b===fb.autoFabricSetupFailed||b===eb.fabricSetupFailed)&&Ua[c].participants){j&&(j.statsInterval=_(j.statsInterval),ac(j,c));var n=ea(c);n.conferenceFinished&&fa(c,n.ucID)}if((b===eb.fabricSetup||b===eb.fabricUsageEvent)&&!j.fabricUsageSent){var o=j.fabricUsage;j.fabricUsageSent=!0,Pb(eb.fabricUsageEvent,g,c,i.ucID,o,j.pcHash,null)}return Ub(hb.success)}},cc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},dc=function(a,b,c,d,g,h){if(void 0===a||!c||!b)return console.error("reportError: Arguments missing/invalid"),Ub(hb.error,"reportError: Arguments missing/invalid");if(!wa||!xa)return console.error("reportError: SDK is not initialized"),Ub(hb.error,"reportError: SDK is not initialized");if(!rb.hasOwnProperty(c))return console.error("reportError: Invalid webRTC functionName value: %o",c),Ub(hb.error,"reportError: Invalid webRTC functionName value: "+c);void 0===d&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=f(),m=Ua[b],n=null;if(i=S(c),d&&d instanceof DOMException)d={message:d.message,name:d.name};else if(d&&"object"==typeof d){var o={};d.hasOwnProperty("message")&&(o.message=d.message),d.hasOwnProperty("name")&&(o.name=d.name),d.hasOwnProperty("constraintName")&&(o.constraintName=d.constraintName),d.hasOwnProperty("stack")&&(o.stack=d.stack),d=o}if(r(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Ub(hb.error,"reportError: Conference ID not found!");if(n=Zb(b,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Ub(hb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var p=n.startTime,q=l-p;if(j={failureDelay:q,reason:i,domError:d,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,"function":c,magicKey:Hb,endpoint:Ta},c===rb.applicationLog||c===rb.applicationError?Pb(eb.applicationErrorLog,k,b,m.ucID,j,n.pcHash,n.pcCallback):Pb(eb.fabricSetupFailed,k,b,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=cc(a,g,"localDescription"),s.sdp.remoteSDP=cc(a,h,"remoteDescription"),Qb(k,b,m.ucID,s,n.pcHash)}}else{null===Hb&&(Hb=e());var t=e();j={failureDelay:0,reason:i,domError:d,"function":c,magicKey:Hb,endpoint:Ta},c===rb.applicationLog||c===rb.applicationError?Pb(eb.applicationErrorLog,k,b,null,j,t,null):Pb(eb.fabricSetupFailed,k,b,null,j,t,null)}return Ub(hb.success)},ec=function(a,b,c){if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Ub(hb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Ub(hb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Ub(hb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Ub(hb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=Ua[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Hb?$a:Hb,null===e&&(e=ha(a)),null===e)return console.error("sendUserFeedback: ucID unavailable"),Ub(hb.error,"sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:wa,version:va,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Qa.authToken&&!Xa?(g.token=Qa.authToken,window.localStorage.setItem("feedback",JSON.stringify(g)),ja(gb.userFeedback,gb.userFeedback,g,c)):(g.clockUnsynced=Xa,Kb({type:gb.userFeedback,action:gb.userFeedback,data:g,callback:c}),Qa.sendAuthenticationRequest(wa,xa)),Ub(hb.success)},fc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Ub(hb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Ub(hb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!r(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Ub(hb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Ua[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Ub(hb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=Zb(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Ub(hb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Mb(d);return void 0===j&&(Za[d]={},j=Mb(d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==xa&&q(g,c,f,a,d),Ub(hb.success)},gc=function(a,b,c,d,g){var h=null,i={authStatus:Qa.tokenData?!0:!1,clockSync:!Xa,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:d,version:va};if(Cb(wa,xa,"stateMachine",i),h="object"==typeof b?b.aliasName:b,!(a&&h&&c&&d))return console.error("addNewFabric: Arguments missing/Invalid"),Ub(hb.error,"addNewFabric: Arguments missing/Invalid");if(!wa||!xa)return console.error("addNewFabric: SDK not initialized."),Ub(hb.error,"addNewFabric: SDK not initialized");if(""===d||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Ub(hb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!r(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Ub(hb.error,"addNewFabric: Invalid PeerConnection object passed");if(!kb.hasOwnProperty(c)||c instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Ub(hb.error,"addNewFabric: Invalid fabricUsage value");var j=f();null===Hb&&(Hb=e());var k=null,l=!1;if(!ca(d)){var m=Y(Hb);Pb(fb.userJoined,null,d,null,m,null,null),l=!0,i={authStatus:Qa.tokenData?!0:!1,clockSync:!Xa,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:d,version:va},Cb(wa,xa,"stateMachine",i)}a.addEventListener("icecandidate",mc,!1),a.addEventListener("iceconnectionstatechange",lc,!1),a.addEventListener("signalingstatechange",ic,!1),a.addEventListener("negotiationneeded",kc,!1);var n=e(),o={pc:a,remoteUserID:h,fabricUsage:c,magicKey:Hb,startTime:j,pcCallback:g,pcState:qb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:n,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};return"function"==typeof a&&(a.callstatsID=e()),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(o.pcState=qb.established),Z(d,k,l),Zb(d,a)||da(d,o),o.pcState===qb.established&&(bc(a,fb.autoFabricSetup,d),jc(o,a,d,h)),Ub(hb.success)},hc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Ub(hb.error,"reportUserIDChange: Arguments missing/Invalid");if(!wa||!xa)return console.error("reportUserIDChange: SDK not initialized."),Ub(hb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Ub(hb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!r(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Ub(hb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Ua[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Ub(hb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Cb(wa,xa,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Ub(hb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=Zb(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Ub(hb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Pb(eb.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Ub(hb.success)},ic=function(a){if(a){var b,c=Ra.codebase,d=null;if(c===yb.firefox)b=a.target;else if(c===yb.chrome)b=a.srcElement;else{if(c!==yb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var e=b.signalingState;"closed"===e&&(d=_b(b),d&&d.fabric&&bc(b,eb.fabricTerminated,d.conferenceID))}}},jc=function(a,b,c,d){null===a.statsInterval&&(a.statsPollingStart=f(),nc(b,c,d),a.statsInterval=setInterval(nc,Va.statsSubmissionIntervalInMS[Va.currentActivePhaseIndex],b,c,d))},kc=function(a){if(a){var b,c=Ra.codebase;if(c===yb.firefox)b=a.target;else if(c===yb.chrome)b=a.srcElement;else{if(c!==yb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=_b(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},lc=function(a){if(a){var b,c=Ra.codebase;if(c===yb.firefox)b=a.target;else if(c===yb.chrome)b=a.srcElement;else{if(c!==yb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,g,h,i=null,j=null;j=_b(b),j&&j.fabric&&(i=j.fabric,d=j.conferenceID,e=i.remoteUserID,g=f(),h=g-i.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(i.gatheringIceCandidatesDelay=h),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(i.connectivityIceStatusDelay=h,i.pcState===qb.initializing?i.fabricSetupSent||bc(i.pc,fb.autoFabricSetup,d):i.pcState===qb.disrupted&&bc(i.pc,fb.fabricDisrupted,d),i.pcState=qb.established,jc(i,b,d,e)):"failed"===b.iceConnectionState?(i.setupFailureTime=h,bc(i.pc,fb.autoFabricSetupFailed,d),i.pcState=qb.failed):"disconnected"===b.iceConnectionState&&(i.startTime=f(),i.pcState=qb.disrupted,i.pcCallback&&i.pcCallback(ib.appConnectivityError,"Connectivity check for PC object to "+e+" failed.")),i.iceConnectionState=b.iceConnectionState)}}},mc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Ra.codebase;if(h===yb.firefox)g=a.target;else if(h===yb.chrome)g=a.srcElement;else{if(h!==yb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=_b(g),i&&i.fabric&&void 0!==b&&-1===i.fabric.iceCandidates.indexOf(b)&&i.fabric.iceCandidates.push(b)}},nc=function(a,b,c){if(!Ua.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!Xb(b,c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return bc(a,eb.fabricTerminated,b),!0;var d=Zb(b,a);if(d.pcState!==qb.established&&d.lastFabricState===d.pcState)return!0;var e=Ra.codebase,g=Ra.name,h=Ua[b].ucID;e===yb.firefox||"Safari"===g?a.getStats(null,R(xa,c,b,h,d,a,d.pcCallback),function(a){Cb(wa,xa,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})}):e===yb.chrome?a.getStats(R(xa,c,b,h,d,a,d.pcCallback)):e===yb.edge&&a.getStats().then(R(xa,c,b,h,d,a,d.pcCallback))["catch"](function(a){Cb(wa,xa,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})});var i,j=f(),k=j-d.statsPollingStart,l=5e3;(k>Va.statsSubmissionPhaseDurationInMS[Va.currentActivePhaseIndex]&&d.intervalAdaptionPhase||Ea===!0)&&(_(d.statsInterval),Ea?(i=Fa,d.intervalAdaptionPhase=!1,Ea=!1):Va.currentActivePhaseIndex<Va.statsSubmissionIntervalInMS.length-1?(Va.currentActivePhaseIndex+=1,i=Va.statsSubmissionIntervalInMS[Va.currentActivePhaseIndex]):(i=La,d.intervalAdaptionPhase=!1),i>l&&(d.initialPhaseOver=!0),d.statsInterval=setInterval(nc,i,a,b,c))},oc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},pc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},qc=function(){Ab(Aa,function(a){if(200===a.status){var b=JSON.parse(a.responseText);oc("eModelThreshold",b,xb),oc("throughputThreshold",b,tb),oc("fractionalLossThreshold",b,wb),oc("rttThreshold",b,vb),oc("currOverPrevFrameRateThreshold",b,ub)}})},rc=function(){var a=sa+"clockSync",b=null,c=null;Ab(a,function(a,d){200===a.status&&(b=JSON.parse(a.response),c=f(),sc(b,d,c))})},sc=function(a,b,c){if(Xa){var d=b/2;if(d>Wa.maxAllowedLatency)Wa.offsetResults=[],Cb(wa,xa,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Wa.offsetResults.push(f)}if(Wa.offsetResults.length>=Wa.syncAttempts){var g=Wa.offsetResults.reduce(function(a,b){return a+b});Wa.currentOffset=g/Wa.offsetResults.length,Wa.offsetResults=[],Xa=!1,Cb(wa,xa,"log",{msg:"clockSync Done"})}else Xa&&setTimeout(function(){rc()},100)}},tc=function(a,c){return Ia?(Cb(wa,xa,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(ib.success,"WebSocket establishment successful."))):Ha?void Cb(wa,xa,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Ha=b.connect(a,{port:ua,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Ha.on("connect",function(){Cb(wa,xa,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Ia=!0,Wa.syncHandler||(Cb(wa,xa,"log",{msg:"start clockSync"}),Wa.offsetResults=[],rc(),Wa.syncHandler=!0),Jb(),Ja?ba():Sb(Ha),Ja=!1}),Ha.on("disconnect",function(){Ia=!1,aa(),Xa&&(Wa.offsetResults=[],Wa.syncHandler=null,Xa=!1),c&&c(ib.httpError,"Connection to the server disappeared.")}),Ha.on("connect_failed",function(){Ia=!1,c&&c(ib.wsChannelFailure,"WebSocket establishment failed.")}),Ha.on("reconnect",function(){Ja=!0}),Ha.on("reconnect_failed",function(){Ia=!1}),void Ha.on("response",function(a){var b=f(),d=JSON.parse(a);if("Error"===d.status)"Invalid client token."===d.reason&&(Qa.tokenData=null,Qa.authToken=null,Qa.sendAuthenticationRequest(wa,xa)),c&&c(ib.csProtoError,a.reason);else if("200 OK"===d.status)if("feedback"===d.event)window.localStorage.removeItem("feedback");else if(d.event===fb.userJoined||d.event===fb.refreshPresence){var e,g=!1,h=null,i=decodeURIComponent(d.conferenceID),j=function(a){return setInterval(function(){Rb(a)},Na)};for(e in Ua)if(Ua.hasOwnProperty(e)&&e===i){Ua[e].ucID!==d.ucID&&(g=!0,ga(e,d.ucID),h=d.conferenceCreationTS?d.conferenceCreationTS:d.conferenceDuration),d.event!==fb.userJoined||Ua[e].refreshPresence||(Ua[e].refreshPresence=j(i),oa()),Ua[e].ucID=d.ucID;break}Tb(),Ib(g,h)}else d.event===gb.clockSync&&sc(d,b)}))};return i(),qc(),rc(),na(),{version:va,initialize:Vb,fabricEvent:eb,addNewFabric:gc,sendFabricEvent:bc,sendUserFeedback:ec,associateMstWithUserID:fc,csError:ib,fabricUsage:kb,qualityRating:mb,webRTCFunctions:rb,reportError:dc,reportUserIDChange:hc,userIDType:lb,callStatsAPIReturnStatus:hb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);
//# sourceMappingURL=callstats-nologs.min.js.map
/*! callstats.js  version = 3.14.1 2016-08-11 */

function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))?(d="Firefox",f=c.substring(a+8),b=g.moz):-1!==(a=c.indexOf("Trident"))&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j+" "+l,codebase:b}}
//# sourceMappingURL=detect-browser.min.js.map
/*! callstats.js  version = 3.14.1 2016-08-11 */

function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}
//# sourceMappingURL=measure-callstats-loading-perf.min.js.map